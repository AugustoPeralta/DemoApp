# File: pull_request.yaml

#parameters:
#  - name: 'package'
#    default: false

jobs:
  - job: Build
    steps:
      # Build artifacts
      - script: yarn
        displayName: Install Packages
#      - script: yarn lint
#        displayName: linting
      - script: yarn test
        displayName: unit testing
      - script: yarn build
        displayName: build

      - script: npm run pack

      - task: DeleteFiles@1
        inputs:
          Contents: "node_modules"
      - task: DeleteFiles@1
        inputs:
          Contents: "Tests"
      # publish package as artifact

      - task: CopyFiles@2
        inputs:
          TargetFolder: "$(Build.ArtifactStagingDirectory)/functionapp"

      - task: ArchiveFiles@1
        inputs:
          rootFolder: "$(Build.ArtifactStagingDirectory)/functionapp"
          includeRootFolder: "false"
          archiveFile: "$(Build.ArtifactStagingDirectory)/functionapp.zip"

      - task: PublishBuildArtifacts@1
        inputs:
          PathtoPublish: "$(Build.ArtifactStagingDirectory)/functionapp.zip"
          ArtifactName: "drop"
          ArtifactType: "Container"

    
  